name: Social Media Publisher

on:
  schedule:
    # Run every hour to check if anything is due
    - cron: '0 * * * *'
  workflow_dispatch: # Allows manual trigger for testing

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install supabase requests requests-oauthlib python-dotenv

      - name: Run Publisher Script
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          INSTAGRAM_ACCESS_TOKEN: ${{ secrets.INSTAGRAM_ACCESS_TOKEN }}
          INSTAGRAM_BUSINESS_ACCOUNT_ID: ${{ secrets.INSTAGRAM_BUSINESS_ACCOUNT_ID }}
          INSTAGRAM_BUSINESS_ACCOUNT_ID_1: ${{ secrets.INSTAGRAM_BUSINESS_ACCOUNT_ID_1 }}
          INSTAGRAM_BUSINESS_ACCOUNT_ID_2: ${{ secrets.INSTAGRAM_BUSINESS_ACCOUNT_ID_2 }}
          TWITTER_CONSUMER_KEY: ${{ secrets.TWITTER_CONSUMER_KEY }}
          TWITTER_CONSUMER_SECRET: ${{ secrets.TWITTER_CONSUMER_SECRET }}
          # Per-account access tokens
          TWITTER_ACCESS_TOKEN_ACCOUNT_1: ${{ secrets.TWITTER_ACCESS_TOKEN_ACCOUNT_1 }}
          TWITTER_ACCESS_TOKEN_SECRET_ACCOUNT_1: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET_ACCOUNT_1 }}
          TWITTER_ACCESS_TOKEN_ACCOUNT_2: ${{ secrets.TWITTER_ACCESS_TOKEN_ACCOUNT_2 }}
          TWITTER_ACCESS_TOKEN_SECRET_ACCOUNT_2: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET_ACCOUNT_2 }}
          TWITTER_ACCESS_TOKEN_ACCOUNT_3: ${{ secrets.TWITTER_ACCESS_TOKEN_ACCOUNT_3 }}
          TWITTER_ACCESS_TOKEN_SECRET_ACCOUNT_3: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET_ACCOUNT_3 }}
        run: python publisher_script.py
